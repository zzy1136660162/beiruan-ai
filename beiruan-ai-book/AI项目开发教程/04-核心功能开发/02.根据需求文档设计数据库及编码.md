### 教学目标

- 从需求文档出发，梳理功能与数据模型，产出数据库设计文档与初始化 SQL。
- 基于设计快速生成后端/前端代码、菜单与权限，形成可运行的端到端最小可用版本。
- 通过问题驱动示例（如 `del_flag`、菜单重复）讲解排错思路与修复方法。

---

### 步骤一：从需求到功能清单

- 提示词（用于让 AI 汇总需求并落地到功能列表）：
  - 分析我的需求文档，结合现有项目，列出需要开发的功能，给出模块边界与接口清单。

需求文档：
```text
  2.功能需求
  2.1.指标库（标书中“问题管理”）
  2.2.功能描述：
  指标库是绩效考核的基础，用于存储和管理绩效考核指标。
  2.3.主要功能：
  指标管理：支持新增、修改、删除、查询指标
  指标属性：年份、指标种类（主要包括部门、个人）、指标分类、适用部门、指标名称、指标说明、评分标准、评分来源、考核分值等
  指标分类管理：支持按类别、适用对象等维度对指标进行分类管理
  指标查询：支持多条件组合查询，支持模糊
  2.4.考核周期（标书中名称“任务管理”）
  2.4.1.功能描述：
  考核周期模块用于设置和管理绩效考核的时间范围及相关配置。
  2.4.2.主要功能：
  考核周期管理：支持新增、修改、删除、查询考核周期
  考核周期属性：考核周期（如季度、半年、年度）、年份、考核开始时间、考核结束时间、状态（未开始、进行中、已结束）
  考核配置：在考核周期中配置员工考核、部门考核、中层考核的分类与评分职位、评分权重
  考核周期查询：支持按时间、状态等条件查询考核周期
  考核周期统计：统计不同周期的考核数量、状态分布等信息
  2.5.个人考核方案（主要包括中层和员工）（标书中名称“任务管理”）
  2.5.1.功能描述：
  个人考核方案模块主要是针对个人的考核流程，根据集团绩效考核方案，由指定的角色创建和配置。
  2.5.2.主要功能：
  考核方案创建：创建个人考核方案，关联考核周期
  被考核人设置：选择需要考核的个人
  考核关系设置：设置被考核个人的考核角色
  指标配置：根据考核周期中配置的分类添加考核指标（可从指标库中选择）
  指标修改：在方案中修改指标
  评分权重设置：为不同考核角色设置评分权重
  方案提交：提交方案供指定角色审核
  方案查看：查看已创建的考核方案
  方案修改：在审核前可修改方案内容
  2.6.部门考核方案（标书中名称“任务管理”）
  2.6.1.功能描述：
  部门考核方案模块供综合管理部（人力资源部）使用，用于创建和配置部门级别的考核流程。
  2.6.2.主要功能：
  考核方案创建：综合管理部（人力资源部）创建部门考核方案
  被考核部门设置：选择需要考核的部门
  考核关系设置：设置被考核部门的考核角色
  指标配置：根据部门考核模板中配置的分类从指标库中选择相应指标
  指标修改：在方案中修改指标（不影响指标库）
  评分权重设置：为不同考核关系人设置评分权重
  方案审核：综合管理部（人力资源部）提交相关领导审核后，在系统内审核部门考核方案
  方案查看：查看已创建的考核方案
  方案修改：在审核前可修改方案内容
  2.7.绩效评价（标书中名称“工作填报”）
  2.7.1.功能描述：
  绩效评价模块用于进行绩效考核评分。
  2.7.2.主要功能：
  评价任务查看：员工登录系统后查看需要评价的对象
  评价指标查看：查看需要评价的指标及评分标准
  评分提交（标书中名称“工作填报”）：对每个指标进行评分并提交
  评价历史查看：在指定权限内查看历史评价记录
  评价状态查看：在指定权限内查看评价任务的完成状态
  2.8.考核进度跟踪（标书中“工作看板”）
  2.8.1.功能描述：
  考核进度跟踪模块供综合管理部（人力资源部）使用，用于监控考核评分的进度。
  2.8.2.主要功能：
  考核方案进度查看：查看每个考核方案的评分进度，包含应评价人数、已评价人数、未评价人数、完成比例
  未评价人员提醒：识别未完成评价的人员
  进度统计：提供考核进度的统计分析功能
  2.9.考核结果（标书中“汇总统计”）
  2.9.1.功能描述：
  考核结果模块供综合管理部（人力资源部）使用，用于查看和管理考核结果。
  2.9.2.主要功能：
  考核结果查看：查看所有考核方案的最终评分
  详细评分查看：查看每个方案的详细评分经过
  结果导出：支持导出所有人、部门的得分
  单个评分导出：支持导出单个人的评分
  结果分析：支持对考核结果进行简单的分析（如部门平均分、最高分、最低分等）
  结果确认：支持查看员工签字确认状态
```


显示：
![img.png](02assets%2Fimg.png)

---

### 步骤二：抽象数据模型与生成 SQL

- 提示词：
  - 根据功能与数据关系，设计 ER 模型并输出数据库设计文档与建表 SQL（表前缀 `kpi_`，遵循若依审计字段与软删除约定）。

生成的 SQL 示例：
![img_1.png](02assets%2Fimg_1.png)

---

### 步骤三：开始编码（后端/前端/菜单权限）

- 提示词：
  - 根据需求和数据库设计，直接开始开发：生成后端与前端 CRUD 代码，创建菜单、权限点与路由，并对接 `sys_menu` 动态路由机制。

AI 开发过程展示：
![img_2.png](02assets%2Fimg_2.png)

---

### 步骤四：维护开发进度文档

- 提示词：
  - 继续开发并更新开发进度文档（需要开发 / 已开发 / 未开发）。将文档落盘到 `doc/` 目录。

展示：
![img_3.png](02assets%2Fimg_3.png)

---

### 步骤五：启动项目进行联调验收

- 启动与检查：
  - 后端：`ruoyi-admin` 启动；前端：`ruoyi-ui` 启动；检查新增页面可访问与接口可用。

页面示例：
![img_5.png](02assets%2Fimg_5.png)

---

### 常见问题与修复示例

1) 菜单重复显示

- 现象：新增的绩效管理菜单在左侧重复出现。
- 分析：若依使用 `sys_menu` 维护动态路由；AI 生成的前端路由若重复定义菜单项，会与后端动态路由叠加。
- 修复：删除前端硬编码的路由菜单，仅保留 `sys_menu` 驱动。
- 提示词：
  - 新开发的绩效管理菜单重复出现了，帮我定位并解决。

截图：
![img_6.png](02assets%2Fimg_6.png)

2) 新增后列表无数据（`del_flag` 初始化）

- 现象：在“指标分类”模块，新增提示成功但列表无数据。
- 分析：插入时 `del_flag` 未初始化为 `'0'`，导致被视为删除状态或被逻辑条件过滤。
- 修复：后端插入默认 `del_flag='0'`；SQL/实体默认值/拦截器保证一致性。

AI 分析截图：
![AI分析插入数据del_flag 字段异常](02assets%2Fimg_11.png)

修复后：
![指标分类数据正常显示](02assets%2Fimg_10.png)

---

### 持续迭代开发（示例轨迹）

- 继续开发并更新任务文档：
![AI继续开发后续代码](02assets%2Fimg_12.png)

- 人员考核方案→部门考核方案（后端完成 → 前端实现）：
![img_13.png](02assets%2Fimg_13.png)
![img_14.png](02assets%2Fimg_14.png)

- 导入新增的前端路由菜单 SQL（在 Navicat 中执行）：
![新增菜单sql](02assets%2Fimg_15.png)
![运行新增菜单sql](02assets%2Fimg_16.png)

- 继续开发绩效评价与评分模块（后端+前端）：
![继续开发绩效评价模块](02assets%2Fimg_17.png)

- 运行评价与评分菜单 SQL：
![评价和评分菜单sql](02assets%2Fimg_18.png)

- 完成 KPI 考核结果与签字模块：
![img_19.png](02assets%2Fimg_19.png)


- 一气呵成，让AI继续完成其他模块的编码
![img_20.png](02assets%2Fimg_20.png)



---

### 验收清单（建议）

- 数据库：表结构/索引/约束与文档一致；`del_flag` 默认值与软删规范一致。
- 接口：Swagger/Knife4j 可调通；权限码与菜单一致；数据范围生效。
- 前端：页面路由仅由 `sys_menu` 驱动；列表/表单/校验可用；状态字典正确渲染。
- 计算：权重校验与评分汇总口径一致；幂等与唯一性（如 `kpi_score(task_id)`）生效。
- 文档：`doc/` 中进度文档、差异说明与运维指引更新到位。
