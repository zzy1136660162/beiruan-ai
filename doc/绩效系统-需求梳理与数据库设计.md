### 1. 背景与目标
- 在若依前后端分离框架基础上，建设“人员绩效管理系统”。
- 覆盖指标库、考核周期、个人/部门考核方案、绩效评价、进度跟踪、考核结果等全流程。

---

### 2. 功能清单（按模块）
- 指标库
  - 指标管理：新增、修改、删除、查询
  - 指标属性：年份、指标种类（部门/个人/中层）、指标分类、适用部门、指标名称、指标说明、评分标准、评分来源、考核分值
  - 指标分类管理：按类别、适用对象等维度分类
  - 指标查询：多条件组合、模糊查询
- 考核周期
  - 周期管理：新增、修改、删除、查询
  - 周期属性：周期类型（季度/半年/年度/自定义）、年份、开始/结束时间、状态（未开始/进行中/已结束）
  - 考核配置：在周期中配置员工/中层/部门的评分职位/评分权重
  - 周期统计：按时间、状态统计
- 个人考核方案（含员工/中层）
  - 方案创建/查看/提交/审核/修改（审核前可改）
  - 被考核人设置
  - 考核关系设置（角色/职位）
  - 指标配置（从指标库选择，可覆盖说明与分值，不影响指标库）
  - 评分权重设置（按考核角色）
- 部门考核方案
  - 方案创建/查看/提交/审核/修改（审核前可改）
  - 被考核部门设置
  - 考核关系设置（角色/职位）
  - 指标配置（从指标库选择，可覆盖说明与分值）
  - 评分权重设置（按关系人）
- 绩效评价
  - 评价任务查看（待我评价）
  - 指标与评分标准查看
  - 评分提交（单指标评分+评语）
  - 历史评价查看、评价状态查看
- 进度跟踪（工作看板）
  - 方案进度：应评/已评/未评/完成比例
  - 未评价人员提醒
  - 进度统计分析
- 考核结果（汇总统计）
  - 最终得分查看（个人/部门）
  - 详细评分过程查看
  - 导出（全量/单人）
  - 结果分析（平均分、最高/最低等）
  - 结果确认（签字状态）

---

### 3. 角色与对象
- 角色（示例）：员工、直属上级、部门负责人、分管领导、HR、管理员
- 对象：个人（员工/中层）、部门

---

### 4. 数据模型与关系（ER 概览）
- 分类与指标
  - kpi_indicator_category 1—N kpi_indicator
  - kpi_indicator N—N sys_dept（kpi_indicator_dept）
- 周期与配置
  - kpi_cycle 1—N kpi_cycle_weight
- 方案（人/部门）
  - kpi_person_plan 1—N kpi_person_plan_item
  - kpi_person_plan 1—N kpi_person_plan_rater
  - kpi_dept_plan 1—N kpi_dept_plan_item
  - kpi_dept_plan 1—N kpi_dept_plan_rater
- 评价与结果
  - 方案项 → 生成 kpi_eval_task（按评价关系/职位/人员）
  - kpi_eval_task 1—1 kpi_score
  - 方案 → 汇总 kpi_result（以及 kpi_result_item）
  - kpi_result 1—N kpi_result_sign

---

### 5. 表设计说明（关键字段）
- kpi_indicator_category（指标分类）
  - id, parent_id, name, sort, status, remark, create/update, del_flag
- kpi_indicator（指标库）
  - id, year, kind（dept/person/middle）, category_id, name, description, scoring_standard, source, score_full, status, remark, create/update, del_flag
- kpi_indicator_dept（指标-适用部门）
  - id, indicator_id, dept_id（参照 sys_dept）
- kpi_cycle（考核周期）
  - id, cycle_type（quarter/half/year/custom）, year, start_time, end_time, status, remark, create/update, del_flag
- kpi_cycle_weight（周期评分权重配置）
  - id, cycle_id, subject_type（person/dept/middle）, rater_post_id（参照 sys_post）, weight
- kpi_person_plan（个人方案）
  - id, cycle_id, target_user_id, target_type（employee/middle）, status（draft/pending/approved/rejected/active/finished）, submit_time, approve_user_id, approve_time, remark
- kpi_person_plan_item（个人方案指标项）
  - id, plan_id, indicator_id, indicator_name, scoring_standard, score_full, item_weight（可选）, sort
- kpi_person_plan_rater（个人方案-考核关系/权重）
  - id, plan_id, rater_user_id, rater_post_id, weight
- kpi_dept_plan（部门方案）
  - id, cycle_id, target_dept_id, status, submit_time, approve_user_id, approve_time, remark
- kpi_dept_plan_item / kpi_dept_plan_rater 类似个人方案结构
- kpi_eval_task（评价任务）
  - id, plan_type（person/dept）, plan_id, plan_item_id, target_user_id, target_dept_id, rater_user_id, rater_post_id, deadline, status（pending/done/expired）, finish_time
- kpi_score（评分）
  - id, task_id, score, comment, create_by, create_time
- kpi_result（考核结果汇总）
  - id, plan_type, plan_id, target_user_id, target_dept_id, final_score, complete_ratio, status（generated/confirmed）, generate_time
- kpi_result_item（结果明细-按指标）
  - id, result_id, plan_item_id, indicator_id, score
- kpi_result_sign（结果确认）
  - id, result_id, user_id, sign_status（0未签/1已签）, sign_time

---

### 6. 字典与枚举（建议写入 sys_dict）
- kpi_kind：dept/department，person/employee，middle/leader
- kpi_cycle_type：quarter/half/year/custom
- kpi_status：draft/pending/approved/rejected/active/finished
- kpi_task_status：pending/done/expired
- kpi_result_status：generated/confirmed

---

### 7. 约束与索引
- 常用查询字段建立索引：year、category_id、kind、status、cycle_id、plan_id、rater_user_id、target_user_id/target_dept_id、task.status
- 评分唯一性：同一 task 仅允许一条 kpi_score（UNIQUE KEY）
- 权重合规：同一方案的 rater 权重之和=100（业务校验）
- 软删除：统一 del_flag='0' 生效，'2' 删除

---

### 8. 生成/计算流程
- 方案审核通过后：按方案项×评价关系生成 kpi_eval_task
- 打分提交：更新 task.status=done 并写入 kpi_score
- 汇总：按配置权重计算最终分，写入 kpi_result 与 kpi_result_item
- 确认：目标对象对结果签字（kpi_result_sign）

---

### 9. 与若依集成说明
- 用户/部门/岗位：复用 `sys_user`、`sys_dept`、`sys_post`
- 审计字段：create_by、create_time、update_by、update_time、remark、del_flag
- 接口鉴权：沿用 token 机制与权限标识（如 kpi:indicator:list）
- 代码生成：建议以 kpi_ 前缀创建表后，使用代码生成器快速出 CRUD，再按本文档做适配 