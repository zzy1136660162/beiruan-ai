### 概览

- **目标**: 快速熟悉若依（RuoYi）前后端分离项目，并基于该框架开展“人员绩效管理系统”的二次开发。
- **读者**: 初中级 Java/Vue 工程师、AI（Cursor）助教/讲师、学员。
- **仓库结构（本项目）**:
  - `ruoyi-admin`: Spring Boot 启动模块（Web/接口入口）。
  - `ruoyi-framework`: 框架层（安全、拦截器、配置等）。
  - `ruoyi-system`: 业务系统模块（系统用户、菜单、角色、字典等）。
  - `ruoyi-common`: 通用模块（工具类、注解、异常、常量、XSS 等）。
  - `ruoyi-quartz`: 定时任务模块。
  - `ruoyi-generator`: 代码生成器模块（根据表结构生成前后端增删改查）。
  - `ruoyi-ui`: 前端 Vue2 + Element-UI 管理端。
  - `sql`: 初始化 SQL（如 `ry_20250522.sql`）。
  - `doc`: 文档。

---

## 一、运行环境与启动

### 1. 基础环境
- JDK 8+（建议 1.8）
- Maven 3.6+
- Node.js 14~18（Vue CLI 4 兼容范围），NPM 6+
- MySQL 5.7/8.0
- Redis 5+

### 2. 数据库准备
- 新建数据库（示例）: `ry-vue`（与配置保持一致）
- 导入初始化 SQL: `sql/ry_20250522.sql`

### 3. 后端配置（关键摘录）
- 文件: `ruoyi-admin/src/main/resources/application-druid.yml`
```12:18:ruoyi-admin/src/main/resources/application-druid.yml
            slave:
                # 从数据源开关/默认关闭
                enabled: false
                url: 
                username: 
                password: 
```
- 主数据源（修改为你的 MySQL 实例）:
```8:12:ruoyi-admin/src/main/resources/application-druid.yml
            master:
                url: jdbc:mysql://localhost:3306/ry-vue?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
                username: root
                password: password
```
- Redis（如需修改）: `ruoyi-admin/src/main/resources/application.yml`
```68:79:ruoyi-admin/src/main/resources/application.yml
spring:
  redis:
    host: localhost
    port: 6379
    database: 0
    password:
    timeout: 10s
```
- 服务端口与上下文:
```16:23:ruoyi-admin/src/main/resources/application.yml
server:
  port: 8080
  servlet:
    context-path: /
```
- Token 配置:
```91:99:ruoyi-admin/src/main/resources/application.yml
# token配置
token:
  header: Authorization
  secret: abcdefghijklmnopqrstuvwxyz
  expireTime: 30
```

### 4. 启动后端
- IDE 启动: 运行 `com.ruoyi.RuoYiApplication`（`ruoyi-admin` 模块）。
- 命令行: `mvn -f pom.xml -DskipTests clean package` 后运行生成的 jar（或直接在 IDE 运行）。
- 启动成功后后端默认地址: `http://localhost:8080`

### 5. 启动前端
- 前端端口与代理: `ruoyi-ui/vue.config.js`
```12:15:ruoyi-ui/vue.config.js
const baseUrl = 'http://localhost:8080' // 后端接口
const port = process.env.port || process.env.npm_config_port || 80 // 端口
```
- 开发代理（需设置 `VUE_APP_BASE_API`，通常为 `/dev-api`，与后端 `swagger.pathMapping` 对应）:
```115:121:ruoyi-admin/src/main/resources/application.yml
swagger:
  enabled: true
  pathMapping: /dev-api
```
- 若仓库无 `.env.development`，建议新建：
```env
VUE_APP_BASE_API=/dev-api
VUE_APP_TITLE=若依管理系统
```
- 安装与启动：
```bash
cd ruoyi-ui
npm install
npm run dev
# 默认打开 http://localhost （端口 80）。
```

---

## 二、架构与关键机制

### 1. 权限与认证
- 前端 Token 存储：`Cookies['Admin-Token']`
```1:12:ruoyi-ui/src/utils/auth.js
const TokenKey = 'Admin-Token'
export function getToken() { return Cookies.get(TokenKey) }
export function setToken(token) { return Cookies.set(TokenKey, token) }
```
- 后端安全链：Spring Security + JWT
```96:129:ruoyi-framework/src/main/java/com/ruoyi/framework/config/SecurityConfig.java
httpSecurity
  .csrf(csrf -> csrf.disable())
  .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
  .authorizeHttpRequests((requests) -> {
    // 登录/注册/验证码放行
    requests.antMatchers("/login", "/register", "/captchaImage").permitAll()
    // 其他均需鉴权
    .anyRequest().authenticated();
  })
  .addFilterBefore(authenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);
```
- 令牌 Header：`Authorization`（见 `token.header`）。
- 角色/权限：基于注解与菜单权限字符串；前端有 `v-hasPermi` 指令（`ruoyi-ui/src/directive/permission/hasPermi.js`）。

### 2. 目录与职责（后端）
- `controller` 接口层、`service` 业务层、`mapper` 持久层、`domain` 实体层。
- MyBatis XML：对应模块 `resources/mapper/**/**Mapper.xml`（见 `application.yml` 中 `mapperLocations`）。
- 分页：`PageHelper` 已全局配置。
- 日志/审计：`@Log` 注解（见 `ruoyi-common`）。

### 3. 目录与职责（前端）
- `src/api`：接口请求封装（axios）。
- `src/views`：业务页面（.vue）。
- `src/router`：路由与动态菜单。
- `src/store`：全局状态。
- `src/components`：通用组件（分页、上传、编辑器等）。
- 代理转发：`/dev-api` → `http://localhost:8080`（见 `vue.config.js`）。

---

## 三、代码生成器与快速建模
- 配置：`ruoyi-generator/src/main/resources/generator.yml`
```1:12:ruoyi-generator/src/main/resources/generator.yml
# 代码生成
gen:
  author: ruoyi
  packageName: com.ruoyi.system
  autoRemovePre: false
  tablePrefix: sys_
  allowOverwrite: false
```
- 使用路径：前端左侧菜单「系统工具 → 代码生成」。
- 步骤：
  1) 在数据库建表；
  2) 在生成器页面导入表 → 配置基本信息（包、模块名、业务名、权限标识等）；
  3) 选择模板生成；
  4) 下载或直接覆盖到后端/前端；
  5) 后端编译并启动，前端热更新后即可调试。

---

## 四、绩效管理模块二次开发示例

### 1. 业务拆分建议
- 指标管理（Indicator）：定义绩效指标与权重。
- 绩效周期（Period）：如月度/季度。
- 任务分配（Assignment）：将指标分配给人员或岗位。
- 绩效打分（Score）：多维度评分与评语，支持自评/他评/上级评。
- 汇总与报表（Report）：个人/部门/周期维度统计。

### 2. 数据表（示例字段）
- `kpi_indicator(id, name, weight, description, status, create_time, update_time)`
- `kpi_period(id, name, start_date, end_date, status)`
- `kpi_assignment(id, period_id, user_id, indicator_id, target_value, create_time)`
- `kpi_score(id, assignment_id, rater_user_id, score, comment, type, create_time)`

> 命名规范：表前缀按团队约定；生成器默认前缀 `sys_` 可在 `generator.yml` 调整。

### 3. 快速生成步骤
1) 建表并添加必要索引/外键；
2) 进入「代码生成」，导入 `kpi_*` 表；
3) 配置模块名（如 `kpi`）、包名（如 `com.ruoyi.kpi`）、业务名与权限标识；
4) 生成代码，合入后端/前端；
5) 在菜单里为新模块添加路由与按钮权限；
6) 运行联调，完善字段校验与导入/导出；
7) 编写统计查询与图表（前端可用 ECharts）。

### 4. 前后端要点
- 前端视图放在 `src/views/kpi/**`，接口在 `src/api/kpi/**`；
- 使用现有组件：`Pagination`、`RightToolbar`、`ImageUpload` 等；
- 权限指令：`v-hasPermi="['kpi:indicator:add']"`；
- 后端按规范放置：`controller/service/service/impl/mapper/domain`；
- 统一返回与异常：复用若依 `AjaxResult`、全局异常处理；
- 日志：`@Log(title = "指标管理", businessType = BusinessType.INSERT)`；
- 数据权限（如需要部门过滤）可参考系统用户/部门实现。

---

## 五、部署与运维

### 1. 后端打包
```bash
mvn -DskipTests clean package
# 启动示例
java -jar ruoyi-admin/target/*.jar --spring.profiles.active=druid
```

### 2. 前端构建
```bash
cd ruoyi-ui
npm run build:prod
# 产物在 ruoyi-ui/dist （静态资源）
```

### 3. 网关/Nginx（示例思路）
- 将 `dist` 部署到 Nginx 静态目录；
- 反向代理 `/dev-api` 到后端 `http://server:8080`；
- 确保与后端 `swagger.pathMapping=/dev-api`、前端 `VUE_APP_BASE_API=/dev-api` 一致。

### 4. 常见问题
- 登录跨域：检查前端代理是否将 `VUE_APP_BASE_API` 指向后端；
- 404/白屏：检查 `publicPath`、路由模式与 Nginx 静态路径；
- 文件上传路径：Windows 默认 `D:/ruoyi/uploadPath`（见 `ruoyi.profile`）。

---

## 六、面向 Cursor 的教学与实操

### 1. 常用操作
- 全局搜索关键能力：
  - 认证链: 搜索 `SecurityConfig`、`JwtAuthenticationTokenFilter`
  - Token 头: 搜索 `token.header` 或 `Authorization`
  - 分页: 搜索 `PageHelper` 或 `pagehelper`
  - 生成器: 查看 `generator.yml` 与前端 `tool/gen`
- 批量编辑：在 Cursor 中选中文件/多选，使用 `AI Edit` 描述修订意图。
- 运行与排障：在内置终端执行 `npm run dev`、`mvn package`，粘贴报错给 AI 进行定位与修复。

### 2. 快速创建 KPI 模块（示例提示词）
- 后端实体/Mapper/Service：
  - "在 `ruoyi-kpi` 模块下创建 `KpiIndicator` 增删改查，参照 `ruoyi-system` 的风格与返回体。"
- 前端页面：
  - "在 `src/views/kpi/indicator/index.vue` 新建列表页，支持查询、分页、导入导出、批量操作，参考 `system/user/index.vue`。"
- 权限与菜单：
  - "增加 `kpi:indicator:list/add/edit/remove/export` 权限点，并为角色分配菜单。"

### 3. 最佳实践
- 尽量使用生成器起步，减少手写样板；
- 保持 `前端 API -> 后端 Controller` 一一对应；
- 优先在 `dev` 环境打通端到端流程，再做安全与边界处理；
- 用 AI 做回归检查（类型、空指针、SQL 风险、权限遗漏）。

---

## 附录：关键文件索引
- `ruoyi-admin/src/main/resources/application.yml`（端口、Redis、Token 配置、路径映射）
- `ruoyi-admin/src/main/resources/application-druid.yml`（数据源）
- `ruoyi-framework/src/main/java/com/ruoyi/framework/config/SecurityConfig.java`（安全配置）
- `ruoyi-generator/src/main/resources/generator.yml`（生成器配置）
- `ruoyi-ui/vue.config.js`（端口与代理）
- `ruoyi-ui/src/utils/auth.js`（前端 Token 存储）
- `sql/ry_20250522.sql`（初始化库）

> 本文档覆盖上手、关键配置与二次开发路径，建议结合生成器与现有示例页面快速落地“绩效管理”模块。 