<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.kpi.mapper.KpiResultMapper">
	<resultMap id="KpiResultResult" type="com.ruoyi.kpi.domain.KpiResult">
		<id property="id" column="id"/>
		<result property="planType" column="plan_type"/>
		<result property="planId" column="plan_id"/>
		<result property="targetUserId" column="target_user_id"/>
		<result property="targetDeptId" column="target_dept_id"/>
		<result property="finalScore" column="final_score"/>
		<result property="completeRatio" column="complete_ratio"/>
		<result property="status" column="status"/>
		<result property="generateTime" column="generate_time"/>
		<result property="createBy" column="create_by"/>
		<result property="createTime" column="create_time"/>
		<result property="updateBy" column="update_by"/>
		<result property="updateTime" column="update_time"/>
	</resultMap>
	<sql id="columns">id, plan_type, plan_id, target_user_id, target_dept_id, final_score, complete_ratio, status, generate_time, create_by, create_time, update_by, update_time</sql>
	<select id="selectKpiResultById" parameterType="long" resultMap="KpiResultResult">select <include refid="columns"/> from kpi_result where id=#{id}</select>
	<select id="selectKpiResultList" parameterType="com.ruoyi.kpi.domain.KpiResult" resultMap="KpiResultResult">
		select <include refid="columns"/> from kpi_result
		<where>
			<if test="planType!=null and planType!=''"> and plan_type=#{planType}</if>
			<if test="planId!=null"> and plan_id=#{planId}</if>
			<if test="targetUserId!=null"> and target_user_id=#{targetUserId}</if>
			<if test="targetDeptId!=null"> and target_dept_id=#{targetDeptId}</if>
			<if test="status!=null and status!=''"> and status=#{status}</if>
		</where>
		order by id desc
	</select>
	<insert id="insertKpiResult" parameterType="com.ruoyi.kpi.domain.KpiResult" useGeneratedKeys="true" keyProperty="id">
		insert into kpi_result(plan_type, plan_id, target_user_id, target_dept_id, final_score, complete_ratio, status, generate_time, create_by, create_time)
		values(#{planType}, #{planId}, #{targetUserId}, #{targetDeptId}, #{finalScore}, #{completeRatio}, IFNULL(#{status},'generated'), IFNULL(#{generateTime}, now()), #{createBy}, now())
	</insert>
	<update id="updateKpiResult" parameterType="com.ruoyi.kpi.domain.KpiResult">
		update kpi_result
		<set>
			<if test="planType!=null and planType!=''"> plan_type=#{planType},</if>
			<if test="planId!=null"> plan_id=#{planId},</if>
			<if test="targetUserId!=null"> target_user_id=#{targetUserId},</if>
			<if test="targetDeptId!=null"> target_dept_id=#{targetDeptId},</if>
			<if test="finalScore!=null"> final_score=#{finalScore},</if>
			<if test="completeRatio!=null"> complete_ratio=#{completeRatio},</if>
			<if test="status!=null and status!=''"> status=#{status},</if>
			<if test="generateTime!=null"> generate_time=#{generateTime},</if>
			update_by=#{updateBy}, update_time=now()
		</set>
		where id=#{id}
	</update>
	<delete id="deleteKpiResultById" parameterType="long">delete from kpi_result where id=#{id}</delete>
	<delete id="deleteKpiResultByIds" parameterType="long">delete from kpi_result where id in <foreach collection="array" item="id" open="(" separator="," close=")">#{id}</foreach></delete>
</mapper> 