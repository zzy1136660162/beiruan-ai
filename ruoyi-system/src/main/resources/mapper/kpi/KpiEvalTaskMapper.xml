<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.kpi.mapper.KpiEvalTaskMapper">
	<resultMap id="KpiEvalTaskResult" type="com.ruoyi.kpi.domain.KpiEvalTask">
		<id property="id" column="id"/>
		<result property="planType" column="plan_type"/>
		<result property="planId" column="plan_id"/>
		<result property="planItemId" column="plan_item_id"/>
		<result property="targetUserId" column="target_user_id"/>
		<result property="targetDeptId" column="target_dept_id"/>
		<result property="raterUserId" column="rater_user_id"/>
		<result property="raterPostId" column="rater_post_id"/>
		<result property="deadline" column="deadline"/>
		<result property="status" column="status"/>
		<result property="finishTime" column="finish_time"/>
		<result property="createBy" column="create_by"/>
		<result property="createTime" column="create_time"/>
		<result property="updateBy" column="update_by"/>
		<result property="updateTime" column="update_time"/>
	</resultMap>
	<sql id="columns">id, plan_type, plan_id, plan_item_id, target_user_id, target_dept_id, rater_user_id, rater_post_id, deadline, status, finish_time, create_by, create_time, update_by, update_time</sql>
	<select id="selectKpiEvalTaskById" parameterType="long" resultMap="KpiEvalTaskResult">select <include refid="columns"/> from kpi_eval_task where id=#{id}</select>
	<select id="selectKpiEvalTaskList" parameterType="com.ruoyi.kpi.domain.KpiEvalTask" resultMap="KpiEvalTaskResult">
		select <include refid="columns"/> from kpi_eval_task
		<where>
			<if test="planType!=null and planType!=''"> and plan_type=#{planType}</if>
			<if test="planId!=null"> and plan_id=#{planId}</if>
			<if test="raterUserId!=null"> and rater_user_id=#{raterUserId}</if>
			<if test="status!=null and status!=''"> and status=#{status}</if>
		</where>
		order by id desc
	</select>
	<insert id="insertKpiEvalTask" parameterType="com.ruoyi.kpi.domain.KpiEvalTask" useGeneratedKeys="true" keyProperty="id">
		insert into kpi_eval_task(plan_type, plan_id, plan_item_id, target_user_id, target_dept_id, rater_user_id, rater_post_id, deadline, status, create_by, create_time)
		values(#{planType}, #{planId}, #{planItemId}, #{targetUserId}, #{targetDeptId}, #{raterUserId}, #{raterPostId}, #{deadline}, IFNULL(#{status},'pending'), #{createBy}, now())
	</insert>
	<update id="updateKpiEvalTask" parameterType="com.ruoyi.kpi.domain.KpiEvalTask">
		update kpi_eval_task
		<set>
			<if test="planType!=null and planType!=''"> plan_type=#{planType},</if>
			<if test="planId!=null"> plan_id=#{planId},</if>
			<if test="planItemId!=null"> plan_item_id=#{planItemId},</if>
			<if test="targetUserId!=null"> target_user_id=#{targetUserId},</if>
			<if test="targetDeptId!=null"> target_dept_id=#{targetDeptId},</if>
			<if test="raterUserId!=null"> rater_user_id=#{raterUserId},</if>
			<if test="raterPostId!=null"> rater_post_id=#{raterPostId},</if>
			<if test="deadline!=null"> deadline=#{deadline},</if>
			<if test="status!=null and status!=''"> status=#{status},</if>
			<if test="finishTime!=null"> finish_time=#{finishTime},</if>
			update_by=#{updateBy}, update_time=now()
		</set>
		where id=#{id}
	</update>
	<delete id="deleteKpiEvalTaskById" parameterType="long">delete from kpi_eval_task where id=#{id}</delete>
	<delete id="deleteKpiEvalTaskByIds" parameterType="long">delete from kpi_eval_task where id in <foreach collection="array" item="id" open="(" separator="," close=")">#{id}</foreach></delete>
</mapper> 