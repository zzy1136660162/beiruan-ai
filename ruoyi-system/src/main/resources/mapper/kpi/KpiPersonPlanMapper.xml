<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.kpi.mapper.KpiPersonPlanMapper">
	<resultMap id="KpiPersonPlanResult" type="com.ruoyi.kpi.domain.KpiPersonPlan">
		<id property="id" column="id"/>
		<result property="cycleId" column="cycle_id"/>
		<result property="targetUserId" column="target_user_id"/>
		<result property="targetType" column="target_type"/>
		<result property="status" column="status"/>
		<result property="submitTime" column="submit_time"/>
		<result property="approveUserId" column="approve_user_id"/>
		<result property="approveTime" column="approve_time"/>
		<result property="remark" column="remark"/>
		<result property="createBy" column="create_by"/>
		<result property="createTime" column="create_time"/>
		<result property="updateBy" column="update_by"/>
		<result property="updateTime" column="update_time"/>
		<result property="delFlag" column="del_flag"/>
	</resultMap>

	<sql id="columns">id, cycle_id, target_user_id, target_type, status, submit_time, approve_user_id, approve_time, remark, create_by, create_time, update_by, update_time, del_flag</sql>

	<select id="selectKpiPersonPlanById" parameterType="long" resultMap="KpiPersonPlanResult">
		select <include refid="columns"/> from kpi_person_plan where id=#{id}
	</select>

	<select id="selectKpiPersonPlanList" parameterType="com.ruoyi.kpi.domain.KpiPersonPlan" resultMap="KpiPersonPlanResult">
		select <include refid="columns"/> from kpi_person_plan
		<where>
			and del_flag='0'
			<if test="cycleId!=null"> and cycle_id=#{cycleId}</if>
			<if test="targetUserId!=null"> and target_user_id=#{targetUserId}</if>
			<if test="status!=null and status!=''"> and status=#{status}</if>
		</where>
		order by id desc
	</select>

	<insert id="insertKpiPersonPlan" parameterType="com.ruoyi.kpi.domain.KpiPersonPlan" useGeneratedKeys="true" keyProperty="id">
		insert into kpi_person_plan(cycle_id, target_user_id, target_type, status, submit_time, approve_user_id, approve_time, remark, create_by, create_time, del_flag)
		values(#{cycleId}, #{targetUserId}, IFNULL(#{targetType},'employee'), IFNULL(#{status},'draft'), #{submitTime}, #{approveUserId}, #{approveTime}, #{remark}, #{createBy}, now(), '0')
	</insert>

	<update id="updateKpiPersonPlan" parameterType="com.ruoyi.kpi.domain.KpiPersonPlan">
		update kpi_person_plan
		<set>
			<if test="cycleId!=null"> cycle_id=#{cycleId},</if>
			<if test="targetUserId!=null"> target_user_id=#{targetUserId},</if>
			<if test="targetType!=null and targetType!=''"> target_type=#{targetType},</if>
			<if test="status!=null and status!=''"> status=#{status},</if>
			<if test="submitTime!=null"> submit_time=#{submitTime},</if>
			<if test="approveUserId!=null"> approve_user_id=#{approveUserId},</if>
			<if test="approveTime!=null"> approve_time=#{approveTime},</if>
			<if test="remark!=null"> remark=#{remark},</if>
			update_by=#{updateBy}, update_time=now()
		</set>
		where id=#{id}
	</update>

	<delete id="deleteKpiPersonPlanById" parameterType="long">delete from kpi_person_plan where id=#{id}</delete>
	<delete id="deleteKpiPersonPlanByIds" parameterType="long">
		delete from kpi_person_plan where id in
		<foreach collection="array" item="id" open="(" separator="," close=")">#{id}</foreach>
	</delete>
</mapper> 